<!DOCTYPE html>

<html>
<head>

<!-- The majority of this code was generated by claude.ai -->

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #45B7D1 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    h1 {
      text-align: center;
      color: #FF6B6B;
      margin-bottom: 20px;
      font-size: 2.2em;
    }

    .setup-section {
      background: linear-gradient(to right, #f8f9fa, #e9ecef);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      border: 2px solid #e2e8f0;
    }

    .chat-section {
      height: 750px;
      display: none;
      flex-direction: column;
    }

    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f7fafc;
      border-radius: 15px;
      margin-bottom: 15px;
      border: 2px solid #e2e8f0;
    }

    .skills-section {
      height: 200px;
      display: flex;
      flex-direction: column;
    }

    .skills-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 15px;
      background: #f7fafc;
      border-radius: 15px;
      margin-bottom: 15px;
      margin-top: 15px;
      border: 2px solid #e2e8f0;
    }

    .message {
      margin-bottom: 12px;
      padding: 8px 12px;
      border-radius: 10px;
      max-width: 80%;
      animation: fadeIn 0.3s ease-in;
      font-size: 0.95em;
    }

    .user-message {
      background: #4ECDC4;
      color: white;
      margin-left: auto;
    }

    .ai-message {
      background: #FF6B6B;
      color: white;
      margin-right: auto;
    }
    .skill-message {
      background: #7e7e7e;
      color: white;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    textarea {
      width: calc(100% - 24px);
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      margin-bottom: 10px;
      font-size: 0.9em;
      resize: none;
      height: 60px;
    }

    input {
      width: calc(100% - 24px);
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      margin-bottom: 10px;
      font-size: 0.9em;
    }

    textarea:focus, input:focus {
      outline: none;
      border-color: #4ECDC4;
      box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
    }

    img {
        width: calc(20% - 24px);
      padding: 8px 12px;
      margin-bottom: 10px;
    }

    button {
      background: linear-gradient(45deg, #FF6B6B, #FF8E53);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s ease;
      text-transform: uppercase;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    button:hover {
      background: linear-gradient(45deg, #FF8E53, #FF6B6B);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
    }

    .typing-indicator {
      display: none;
      padding: 8px;
      background: #e2e8f0;
      border-radius: 10px;
      margin-bottom: 10px;
      animation: pulse 1.5s infinite;
      font-size: 0.9em;
      color: #666;
    }

    @keyframes pulse {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }

    .character-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .character-info > div {
      flex: 1;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: #4a5568;
      font-weight: bold;
      font-size: 0.9em;
    }

    #sceneSetting {
      height: 40px;
    }

    .input-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: #4ECDC4;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #6bdcff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ­ AI Roleplay Chat</h1>
    
    <div class="setup-section">
        <!--<div class="character-info">
        <div>
          <label>Your Character</label>
          <input type="text" id="userCharacter" placeholder="Who are you playing as?">
        </div>
        <div>
          <label>AI Character</label>
          <input type="text" id="aiCharacter" placeholder="Who should the AI play as?">
        </div>
      </div> --->
      <label>Scene Setting</label>
      <textarea id="sceneSetting" placeholder="Describe the scenario and setting..."></textarea>
      <div>
        <label>Skills</label>
        <input type="text" id="skillEnter" placeholder="Type in a skill you want the AI to prompt you to practice!"></textarea>
        <button onclick="addSkill()">Add Skill</button>
        <button onclick="resetSkills()">Reset Skills</button>
      </div>
      <div class="skills-section">
        <div class="skills-messages" id="skillsMessages">
          <!-- Messages will appear here -->
        </div>
      </div>
      <button onclick="startRoleplay()">Begin Roleplay</button>
    </div>

    <div class="chat-section" id="mainChat">
      <div class="chat-messages" id="chatMessages">
        <!-- Messages will appear here -->
      </div>
      <div class="typing-indicator" id="typingIndicator">âœ¨ AI is crafting a response...</div>
      <div class="ai-image">
        <img src="img/N.png" alt="Neutral Face" id = "aiImage">
      </div>
      <div class="input-section">
        <textarea id="userInput" placeholder="Type your message..."></textarea>
        <button onclick="sendMessage()">Send Message</button>
      </div>
    </div>
  </div>

  <script>

    //import { AzureOpenAI } from "openai";

    var messageList = [];
    var skillList = [];
    const expressions = ["N", "H", "S"]

    function addSkill() {
      //const userChar = document.getElementById('userCharacter').value;
      //const aiChar = document.getElementById('aiCharacter').value;
      const skill = document.getElementById('skillEnter').value;

      if (!skill) {
        alert('Please fill in a skill!');
        return;
      }

      skillList.push(skill)

      const skillMessages = document.getElementById('skillsMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = "message skill-message";
      messageDiv.textContent = skill;
      skillMessages.appendChild(messageDiv);
      skillMessages.scrollTop = chatMessages.scrollHeight;
      
      //addMessage('AI', `This is our setting: ${scene}\n\nHello! Let's begin our scene!`);
    }

    function resetSkills() {
      skillList = []
      const skillMessages = document.getElementById('skillsMessages');
      skillMessages.innerHTML = '';
      
      //addMessage('AI', `This is our setting: ${scene}\n\nHello! Let's begin our scene!`);
    }

    function startRoleplay() {
      //const userChar = document.getElementById('userCharacter').value;
      //const aiChar = document.getElementById('aiCharacter').value;
      const scene = document.getElementById('sceneSetting').value;
      let SkillMainList = ""

      if (!scene) {
        alert('Please fill in all fields to begin the roleplay!');
        return;
      }

      let i = 0;

        while (i < skillList.length) {
            SkillMainList = `${SkillMainList}, ${skillList[i]}`
        i++;
        }

      const chatMessages = document.getElementById('chatMessages');
      chatMessages.innerHTML = '';
      messageList = [
        { role: "system", content: `You are a teacher, engaging in roleplay with a student, who is the user, in the following scenario: ${scene}. You want the student to consolidate their skills in a roleplay environment. Focus on these skills: ${SkillMainList} Try to work in questions that help the user improve these skills naturally throughout the roleplay. You will try to use the Socratic method, asking open-ended questions in response to questions and answers from the user. At the end of each message, add a letter to indicate your tone; use a capital N for neutral, capital H for happy, and a capital S for sad; do not use any other letters. Try to use a variety of these letters; don't always use Neutral. Do not forget to do this.`}      
    ];

    setTimeout( async() => {
        const randomResponse = await callAiForResponse();
        const mainResponse = randomResponse.substring(0,randomResponse.length - 1)
        const expression = randomResponse.substring(randomResponse.length - 1,randomResponse.length)
        console.log(expression);

        if (expressions.includes(expression)){
            document.getElementById('aiImage').src = `img/${expression}.png`;
            document.getElementById('aiImage').alt = `${expression} Face`;
            addMessage('AI', mainResponse);
        } else {
            document.getElementById('aiImage').src = `img/N.png`;
            document.getElementById('aiImage').alt = `Neutral Face`;
            addMessage('AI', randomResponse);
        }
        document.getElementById('typingIndicator').style.display = 'none';
      }, 1500);

      document.getElementById('mainChat').style.display = 'flex';
    }

    function sendMessage() {
      const userInput = document.getElementById('userInput');
      const message = userInput.value.trim();
      
      if (!message) return;

      addMessage('user', message);
      userInput.value = '';

      document.getElementById('typingIndicator').style.display = 'block';

      setTimeout( async() => {
        const randomResponse = await callAiForResponse();
        const mainResponse = randomResponse.substring(0,randomResponse.length - 1)
        const expression = randomResponse.substring(randomResponse.length - 1,randomResponse.length)
        console.log(expression);

        if (expressions.includes(expression)){
            document.getElementById('aiImage').src = `img/${expression}.png`;
            document.getElementById('aiImage').alt = `${expression} Face`;
            addMessage('AI', mainResponse);
        } else {
            document.getElementById('aiImage').src = `img/N.png`;
            document.getElementById('aiImage').alt = `Neutral Face`;
            addMessage('AI', randomResponse);
        }
        document.getElementById('typingIndicator').style.display = 'none';
      }, 1500);
    }

    function addMessage(sender, text) {
      const chatMessages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender.toLowerCase()}-message`;
      messageDiv.textContent = text;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      if (sender == "AI") {
        messageList.push({ role: "assistant", content: `${text}` })
      } else if (sender == "user") {
        messageList.push({ role: "user", content: `${text}` })
      }
    }

    async function callAiForResponse() {
        /*import { AzureOpenAI } from "openai";
        //const { AzureOpenAI } = require("openai");
        const endpoint = process.env["AZURE_OPENAI_ENDPOINT"] || "https://educationhackathon.openai.azure.com/";
        const apiKey = process.env["AZURE_OPENAI_API_KEY"] || "F4t6ZhKWbThgotYQuaNURBVcJsDcqL4xkebqwPiVrVHw3s8d7dTjJQQJ99AKACfhMk5XJ3w3AAABACOGoNkI";
        const apiVersion = "2024-08-01-preview";
        const deployment = "gpt-4o"; //This must match your deployment name.

    async function main() {

        const client = new AzureOpenAI({ endpoint, apiKey, apiVersion, deployment });
        var messageList = {}
        const result = await client.chat.completions.create({
            messages: messageList,
            model: "",
        });

         for (const choice of result.choices) {
            console.log(choice.message);
        };

        return result
    }

    main().catch((err) => {
        console.error("The sample encountered an error:", err);
    });*/
    const endpoint = 'https://educationhackathon.openai.azure.com/openai/deployments/gpt-4o/chat/completions?api-version=2024-08-01-preview';
const apiKey = "F4t6ZhKWbThgotYQuaNURBVcJsDcqL4xkebqwPiVrVHw3s8d7dTjJQQJ99AKACfhMk5XJ3w3AAABACOGoNkI";

const requestBody = {
  messages: messageList
};

const response = await fetch(endpoint, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "api-key": apiKey
  },
  body: JSON.stringify(requestBody)
})
    const compiledResponse =  await response.json()
        console.log(compiledResponse);
        console.log(compiledResponse.choices[0].message.content);
        return compiledResponse.choices[0].message.content;
  }

    document.getElementById('userInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>